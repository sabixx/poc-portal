<!DOCTYPE html>
<html>
<head>
  <title>ProductBoard Proxy Test</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 800px;
      margin: 40px auto;
      padding: 20px;
      line-height: 1.6;
    }
    .test-section {
      margin: 30px 0;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }
    button:hover {
      background: #0056b3;
    }
    .result {
      margin-top: 15px;
      padding: 15px;
      background: #f5f5f5;
      border-radius: 6px;
      white-space: pre-wrap;
      font-family: monospace;
      font-size: 12px;
    }
    .success { background: #d4edda; color: #155724; }
    .error { background: #f8d7da; color: #721c24; }
    input {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
      width: 300px;
    }
  </style>
</head>
<body>
  <h1>ProductBoard Proxy Test</h1>
  
  <div class="test-section">
    <h2>Test 1: Check Endpoint Exists</h2>
    <p>This will call <code>/api/productboard/search?query=test</code></p>
    <button onclick="testEndpoint()">Test Endpoint</button>
    <div id="result1" class="result" style="display:none;"></div>
  </div>

  <div class="test-section">
    <h2>Test 2: Custom Search</h2>
    <p>Search for anything:</p>
    <input type="text" id="searchInput" placeholder="Enter search term..." value="api">
    <button onclick="testSearch()">Search</button>
    <div id="result2" class="result" style="display:none;"></div>
  </div>

  <div class="test-section">
    <h2>Test 3: Get Specific Feature</h2>
    <p>Get feature by ID:</p>
    <input type="text" id="featureId" placeholder="Enter feature ID...">
    <button onclick="testGetFeature()">Get Feature</button>
    <div id="result3" class="result" style="display:none;"></div>
  </div>

  <script>
    async function testEndpoint() {
      const result = document.getElementById('result1');
      result.style.display = 'block';
      result.innerHTML = 'Testing...';
      result.className = 'result';
      
      try {
        console.log('[Test] Calling /api/productboard/search?query=test');
        const response = await fetch('/api/productboard/search?query=test');
        
        console.log('[Test] Response status:', response.status);
        console.log('[Test] Response ok:', response.ok);
        
        const text = await response.text();
        console.log('[Test] Response text:', text);
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${text}`);
        }
        
        const data = JSON.parse(text);
        
        result.className = 'result success';
        result.innerHTML = `✅ SUCCESS!

Status: ${response.status}
Response: ${JSON.stringify(data, null, 2)}

Features found: ${data.data ? data.data.length : 0}`;
        
      } catch (error) {
        console.error('[Test] Error:', error);
        result.className = 'result error';
        result.innerHTML = `❌ ERROR!

${error.message}

Possible issues:
1. Endpoint doesn't exist (404)
2. Not authenticated (401)
3. Server error (500)
4. Token not configured

Check browser console for details.`;
      }
    }

    async function testSearch() {
      const query = document.getElementById('searchInput').value;
      const result = document.getElementById('result2');
      result.style.display = 'block';
      result.innerHTML = 'Searching...';
      result.className = 'result';
      
      if (!query) {
        result.className = 'result error';
        result.innerHTML = 'Please enter a search term';
        return;
      }
      
      try {
        console.log('[Test] Searching for:', query);
        const response = await fetch(`/api/productboard/search?query=${encodeURIComponent(query)}`);
        
        console.log('[Test] Response status:', response.status);
        
        const text = await response.text();
        console.log('[Test] Response:', text);
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${text}`);
        }
        
        const data = JSON.parse(text);
        
        if (!data.data || data.data.length === 0) {
          result.className = 'result';
          result.innerHTML = `No features found for "${query}"

Try searching for:
- "auth"
- "api"
- "sso"
- Common feature keywords`;
          return;
        }
        
        result.className = 'result success';
        result.innerHTML = `✅ Found ${data.data.length} features!

${data.data.map(f => `• ${f.title} (${f.status})`).join('\n')}

Full response:
${JSON.stringify(data, null, 2)}`;
        
      } catch (error) {
        console.error('[Test] Error:', error);
        result.className = 'result error';
        result.innerHTML = `❌ ERROR!

${error.message}`;
      }
    }

    async function testGetFeature() {
      const featureId = document.getElementById('featureId').value;
      const result = document.getElementById('result3');
      result.style.display = 'block';
      result.innerHTML = 'Fetching...';
      result.className = 'result';
      
      if (!featureId) {
        result.className = 'result error';
        result.innerHTML = 'Please enter a feature ID';
        return;
      }
      
      try {
        console.log('[Test] Getting feature:', featureId);
        const response = await fetch(`/api/productboard/features/${featureId}`);
        
        console.log('[Test] Response status:', response.status);
        
        const text = await response.text();
        console.log('[Test] Response:', text);
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${text}`);
        }
        
        const data = JSON.parse(text);
        
        result.className = 'result success';
        result.innerHTML = `✅ SUCCESS!

Feature: ${data.title}
Status: ${data.status}
Release: ${data.release || 'Not set'}

Full response:
${JSON.stringify(data, null, 2)}`;
        
      } catch (error) {
        console.error('[Test] Error:', error);
        result.className = 'result error';
        result.innerHTML = `❌ ERROR!

${error.message}`;
      }
    }
    
    // Auto-test on page load
    console.log('[ProductBoard Test] Page loaded');
    console.log('[ProductBoard Test] Click buttons to test endpoints');
  </script>
</body>
</html>